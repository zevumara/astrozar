window.onload=function(){window.astrozar=new Application({debug:!1,preload:["the-answer.ogg","alea-iacta-est.ogg","reveal.ogg","open.ogg","close.ogg","chosen.ogg","holding.ogg","shuffling.ogg","slot-hover.ogg","button.ogg","input.ogg","key.ogg","ambience.mp3","background.webp","astrozar.webp","bg-card.webp","holo.webp","sparkles.webp","icosahedron.webp","octahedron.webp","dodecahedron.webp","stars-landscape.webp","stars-portrait.webp"],customScreens:{welcomeScreen:WelcomeScreen,queryScreen:QueryScreen,shufflingScreen:ShufflingScreen,slotsScreen:SlotsScreen,respondingScreen:RespondingScreen,answerScreen:AnswerScreen},onload:async()=>{const e=document.querySelector(".screen-effects"),t=e.querySelector(".loader");t.classList.add("animation","fade-out"),setTimeout((()=>{e.classList.add("hide"),t.classList.remove("animation","fade-out"),t.classList.add("hide")}),500)}})};class Application{constructor(e=[]){const{debug:t,preload:s,onload:i,customScreens:n}=e;this._config(),this.onload=i,this.screens=new Screens,this.translation=new Translation,this.newSession(),this.screens.initialization(this,n),this._debug(t),this._effects(),this.files=[],this._preloadFiles(s)}async _config(){document.addEventListener("keydown",(e=>{32===e.keyCode&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()}))}newSession(){this.session=JSON.parse(localStorage.getItem("session"))||{deck:{octahedron:[],icosahedron:[],dodecahedron:[]},spread:{id:null,query:null,answer:null,octahedron:null,icosahedron:null,dodecahedron:null}}}f;saveSession(){localStorage.setItem("session",JSON.stringify(this.session))}async _preloadFiles(e=[]){for(let t=0;t<9;t++)e.push(`octahedron-${t}.webp`),e.push(`icosahedron-${t}.webp`),e.push(`dodecahedron-${t}.webp`);await this.translation.load();const t={},s=e.map((async e=>{const[,s]=e.match(/\.(\w+)$/);if("webp"===s){this.debug&&console.log(`Loading "img/${e}" ...`);const s=new Image;await new Promise((i=>{s.addEventListener("load",(function(){t[e]=s,i()})),s.src=`img/${e}`}))}if("ogg"===s||"mp3"===s){this.debug&&console.log(`Loading "audio/${e}" ...`);const s=new Audio;await new Promise((i=>{s.addEventListener("canplaythrough",(function(){t[e]=s,i()})),s.src=`audio/${e}`}))}}));await Promise.all(s),this.files=t,this.debug&&console.log("All files are loaded:",t),this.sound=new AudioManager(t),this._start()}async _start(){const e=new URL(window.location.href).searchParams.get("share"),t=JSON.parse(localStorage.getItem("session"));if(e)try{const t=await fetch(`/share/${e}`),s=await t.json();this.session.spread.id=e,this.session.spread.query=s.query,this.session.spread.answer=s.answer,this.session.spread.octahedron=s.number.substr(0,1),this.session.spread.icosahedron=s.number.substr(2,1),this.session.spread.dodecahedron=s.number.substr(4,1),this.screens.list.answerScreen.prepare(),this.screens.goTo("answerScreen"),this.debug&&console.log("Spread:",this.session.spread)}catch(e){console.error("Error:",e)}else t?(this.screens.list.slotsScreen.restoreSession(),this.screens.goTo("slotsScreen")):this.screens.goTo("welcomeScreen");this.onload()}_debug(e){e&&(this.debug=!0,this.debugElement=document.querySelector("#debug"),this.debugElement.classList.remove("hide"),console.log("-- DEBUG MODE --"))}_effects(){const e=document.querySelector(".animated-background");this.isMobile()?e.remove():(e.classList.remove("hide"),this.debug&&console.log("Effects are activated."))}delay(e,t=(()=>{})){return new Promise((s=>{setTimeout((()=>{t(),s()}),e)}))}screen(){return this.screens.currentScreen}isMobile(){return window.innerWidth<800}}class Screens{constructor(){this.scrollElement=document.querySelector(".screens"),this.currentScreen=null,this.targetScreen=null,this.isTransitioning=!1,this.list={},this.scrollElement.addEventListener("scroll",this.scrollHandler.bind(this)),window.addEventListener("resize",this.resizeHandler.bind(this))}initialization(e,t={}){document.querySelectorAll("section.screen").forEach((s=>{const i=t[s.id]||Screen;this.list[s.id]=new i(e,s.id)}))}goTo(e){return new Promise((t=>{if(this.isTransitioning||!this.list[e]||!this.list[e].el)return t();if(!this.currentScreen)return this.currentScreen=this.list[e],this.currentScreen.activate(),this.scrollElement.scrollTop=this.currentScreen.el.offsetTop,t();this.currentScreen.deactivate(),this.targetScreen=this.list[e],this.isTransitioning=!0,this.targetScreen.el.scrollIntoView({behavior:"smooth"});const s=()=>{if(!this.isTransitioning)return t();requestAnimationFrame(s)};s()}))}scrollHandler(){if(!this.targetScreen?.el)return;Math.ceil(this.scrollElement.scrollTop)===this.targetScreen.el.offsetTop&&(this.currentScreen=this.targetScreen,this.targetScreen=null,this.isTransitioning=!1,this.currentScreen.activate())}resizeHandler(){!this.isTransitioning&&this.currentScreen?.el&&this.scrollElement.scrollTop!=this.currentScreen.el.offsetTop&&(this.scrollElement.scrollTop=this.currentScreen.el.offsetTop)}updateViewport(){for(screen in this.scrollElement.style.height=window.innerHeight+"px",this.scrollElement.style.width=window.innerWidth+"px",this.list)this.list[screen].updateViewport()}}class Screen{constructor(e,t){this._=e,this.name=t,this.el=document.getElementById(t),this.handlers={click:[],input:[],keydown:[]},this.boundHandler=this.handler.bind(this),this.tooltip={},this.updateViewport()}activate(){this.events(),this.addListeners(),this.tooltips(),this.ready()}deactivate(){this.removeListeners(),this.removeEvents(),this.removeTooltips()}events(){}tooltips(){}ready(){}removeTooltips(){for(const e in this.tooltip)this.tooltip[e].hide({remove:!0})}removeEvents(){}addEvent(e,t,s){this.handlers[e].push({selector:t,callback:s})}addListeners(){for(const e in this.handlers)this.el.addEventListener(e,this.boundHandler)}removeListeners(){for(const e in this.handlers)this.el.removeEventListener(e,this.boundHandler)}handler(e){const t=this.handlers[e.type];if(t)for(const s of t)e.target.matches(s.selector)&&("keydown"!==e.type&&e.preventDefault(),s.callback.bind(this)(e.target,e))}playAnimation(e,t,s){return new Promise((i=>{const n=this.el.querySelector(e);n.classList.add("animation",t),s&&(n.style.animationDuration=`${s}ms`),n.addEventListener("animationend",(function(e){e.stopPropagation(),n.classList.remove("animation",t),i("Animation ended")}),{once:!0})}))}addTransition(e){return new Promise((t=>{e.classList.add("transition"),e.addEventListener("transitionend",(function(s){s.stopPropagation(),e.classList.remove("transition"),t("Animation ended")}),{once:!0})}))}async showFlashEffect(){this._.sound.play("button.ogg");const e=document.querySelector(".screen-effects"),t=e.querySelector(".flash");e.classList.remove("hide"),t.classList.remove("hide"),await this._.delay(250),e.classList.add("hide"),t.classList.add("hide")}showProgressBar(e){return new Promise((async t=>{this.progressBarActive=!0,this.screenEffectsEl=document.querySelector(".screen-effects"),this.progressBarEl=this.screenEffectsEl.querySelector(".progress-bar"),this.barEl=this.progressBarEl.querySelector(".progress-bar .bar"),this.screenEffectsEl.style.cursor="grabbing",this.screenEffectsEl.classList.remove("hide"),this.progressBarEl.classList.remove("hide"),this.barEl.style.animation=`scale-x ${e}ms ease-in-out`,await this._.delay(e,(()=>{this.hideProgressBar(),this.progressBarActive&&t()}))}))}cancelProgressBar(){this.progressBarActive=!1,this.hideProgressBar()}hideProgressBar(){this.barEl&&(this.screenEffectsEl.style.cursor="default",this.screenEffectsEl.classList.add("hide"),this.progressBarEl.classList.add("hide"),this.barEl.classList.remove("horizontal-scale"))}async showModal(){document.querySelector(".modal").classList.remove("hide")}hideModal(){document.querySelector(".modal").classList.add("hide")}updateViewport(){this.el.style.height=window.innerHeight+"px",this.el.style.width=window.innerWidth+"px"}}class AudioManager{constructor(e){this.files=e,this.context=null,this.playing=null}play(e,t=!0,s=1,i=!1){this.context||(this.context=new(window.AudioContext||window.webkitAudioContext));const n=this.files[e];if(n)if(n.sourceNode||(n.sourceNode=this.context.createMediaElementSource(n),n.sourceNode.connect(this.context.destination)),t){const t=new Audio(n.src);t.addEventListener("ended",(function(){this.remove()})),t.volume=s,t.loop=i,t.play(),t.id=e.slice(0,-4),this.playing=t}else n.volume=s,n.loop=i,n.id=e.slice(0,-4),n.play(),this.playing=n;else console.error(`Sound "${e}" has not been preloaded.`)}stop(){this.playing&&(this.playing.pause(),this.playing.currentTime=0)}}class Tooltip{constructor(e,t=[]){const{position:s,text:i,name:n,zIndex:o,duration:r}=t;this.name=n||null,this.inactive=localStorage.getItem(n)||!1,this.removeElement=!1,this.duration=r||0,this.position=s||"top",this.text=i||"Empty tooltip.",this.element=document.createElement("div"),this.element.classList.add("tooltip",this.position),this.element.innerHTML=`<p>${this.text}</p>`,o&&(this.element.style.zIndex=o),e.appendChild(this.element)}show(e=0){this.inactive||this.element.classList.contains("show")||(setTimeout((()=>{this.element.classList.add("show"),this.name&&localStorage.setItem(this.name,1)}),e),this.duration&&setTimeout((()=>{this.hide()}),this.duration))}hide(e=[]){if(this.inactive)return;const{delay:t,remove:s}=e;setTimeout((()=>{this.element.classList.remove("show"),s&&setTimeout((()=>{this.element.remove(),this.inactive=!0}),2e3)}),t||0)}}class Translation{constructor(){this.language="es"===navigator.language.slice(0,2)?"es":"en",this.texts=null,this.htmls=null,this.placeholders=null,this.cards=null}async load(){const e=await fetch(`/lang/${this.language}.json`),t=await e.json();this.texts=t.text,this.htmls=t.html,this.cards=t.cards,this.placeholders=t.placeholder;for(const e in this.texts){const t=document.querySelector(`.__${e}`);t&&(t.innerText=this.texts[e])}for(const e in this.htmls){const t=document.querySelector(`.__${e}`);t&&(t.innerHTML=this.htmls[e])}for(const e in this.placeholders){const t=document.querySelector(`.__${e}`);t&&t.setAttribute("placeholder",this.placeholders[e])}document.title=this.texts.title}}class WelcomeScreen extends Screen{constructor(e,t){super(e,t)}reset(){this.el.querySelector("button").classList.remove("disabled")}events(){this.addEvent("click","._changeScreen",(async function(e){this._.sound.play("ambience.mp3",!0,.1,!0),this.el.querySelector("button").classList.add("disabled"),await this.showFlashEffect(),this._.screens.goTo(e.dataset.to)}))}}class QueryScreen extends Screen{constructor(e,t){super(e,t),this.MIN_CHAR=20,this.MAX_CHAR=76,this.queryEl=this.el.querySelector("._textareaQuery")}reset(){this.queryEl.value=""}ready(){this._.isMobile()||this.queryEl.focus()}async changeScreen(){const e=this.queryEl.value,t=e.length;this.queryEl.value=e.slice(0,this.MAX_CHAR),t>this.MIN_CHAR&&(this.queryEl.blur(),"virtualKeyboard"in navigator&&navigator.virtualKeyboard.hide(),this.el.querySelector("button").classList.add("disabled"),await this.showFlashEffect(),this._.screens.goTo(this.el.querySelector("button").dataset.to))}events(){this.addEvent("input","._textareaQuery",(function(e){const t=e.value.length,s=this.el.querySelector("button");this._.sound.play("key.ogg"),t>this.MIN_CHAR&&t<=this.MAX_CHAR?(s.innerText=this._.translation.texts.concern_button,this._.session.spread.query=e.value,s.classList.contains("disabled")&&s.classList.remove("disabled")):(t<this.MIN_CHAR&&(s.innerText=this._.translation.texts.expand_question),this._.session.spread.query=null,s.classList.contains("disabled")||s.classList.add("disabled"))})),this.addEvent("keydown","._textareaQuery",(async function(e,t){13===t.keyCode&&(t.preventDefault(),this.changeScreen())})),this.addEvent("click","._changeScreen",(function(e){this.changeScreen()}))}}class ShufflingScreen extends Screen{constructor(e,t){super(e,t)}async ready(){this.generateDecks(),await this._.delay(1800),this._.screens.goTo("slotsScreen")}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}generateDecks(){const e=Array.from({length:10},((e,t)=>t));for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}for(const e in this._.session.deck){const t=this.shuffleArray([0,1,2,3,4,5,6,7,8,9]),s=[{x:"24px",y:"0"},{x:"-21px",y:"0"},{x:"21px",y:"0"},{x:"-18px",y:"0"},{x:"18px",y:"0"},{x:"-15px",y:"0"},{x:"15px",y:"0"},{x:"-12px",y:"0"},{x:"12px",y:"0"},{x:"0",y:"0"}];for(let i=0;i<10;i++){const n=Math.floor(8*Math.random()-4),o={number:t.pop(),rotation:n,x:s[i].x,y:s[i].y};this._.session.deck[e].push(o)}}}}class SlotsScreen extends Screen{constructor(e,t){super(e,t),this.THRESHOLD=160,this.isAnimating=!1,this.isSelecting=!1,this.dragDistance=0,this.startX=0,this.slotSelected=null,this.startDragBound=this.startDrag.bind(this),this.onMoveBound=this.onMove.bind(this),this.onEndBound=this.onEnd.bind(this)}tooltips(){this.tooltip.tap=new Tooltip(this.el.querySelector(".container"),{text:this._.translation.htmls.tooltip_tap,name:"tooltip_tap"}),this.tooltip.swipe=new Tooltip(this.el.querySelector(".modal"),{text:this._.translation.htmls.tooltip_swipe,name:"tooltip_swipe"}),this.tooltip.hold=new Tooltip(this.el.querySelector(".modal"),{text:this._.translation.htmls.tooltip_hold,position:"bottom",zIndex:4,name:"tooltip_hold"})}reset(){let e=this.el.querySelector(".slot.octahedron");e.classList.remove("lock","subtle-levitation"),e.innerHTML='\n    <div class="type animation rotating"></div>\n    <div class="order">1.</div>\n    <div class="_openModal"></div>',e=this.el.querySelector(".slot.icosahedron"),e.classList.remove("lock","subtle-levitation"),e.innerHTML='\n    <div class="type animation rotating"></div>\n    <div class="order">2.</div>\n    <div class="_openModal"></div>',e=this.el.querySelector(".slot.dodecahedron"),e.classList.remove("lock","subtle-levitation"),e.innerHTML='\n    <div class="type animation rotating"></div>\n    <div class="order">3.</div>\n    <div class="_openModal"></div>'}ready(){this.tooltip.tap.show(500)}events(){this.addEvent("click","._openModal",(async function(e){this._.sound.play("open.ogg"),this.slotSelected=e.parentElement.dataset.slot,this.showModal(),await this.playAnimation(".modal","fade-in",250)})),this.addEvent("click","._closeModal",(async function(e){this._.sound.play("close.ogg"),await this.playAnimation(".modal","fade-out",300),this.hideModal()}));this.el.querySelectorAll("._openModal").forEach((e=>{e.addEventListener("mouseenter",(()=>{this._.sound.play("slot-hover.ogg")}))}))}removeEvents(){this.el.querySelectorAll("._openModal").forEach((e=>{e.removeEventListener("mouseenter")}))}restoreSession(){this.setSlot("octahedron",this._.session.spread.octahedron),this.setSlot("icosahedron",this._.session.spread.icosahedron),this.setSlot("dodecahedron",this._.session.spread.dodecahedron),this.aleaIactaEst()}async saveSlot(e,t){this._.session.spread[e]=parseInt(t),"number"==typeof this._.session.spread.octahedron&&"number"==typeof this._.session.spread.icosahedron&&"number"==typeof this._.session.spread.dodecahedron&&(this._.saveSession(),this.aleaIactaEst())}async aleaIactaEst(){await this._.delay(250),await this.showFlashEffect(),this.tooltip.tap.hide({remove:!0});this.el.querySelectorAll(".slot").forEach((e=>{e.style.transition="all 0.5s ease-in-out",e.classList.add("done")})),await this._.delay(1500),this._.sound.play("alea-iacta-est.ogg"),await this._.delay(5500),this._.screens.goTo("respondingScreen")}showModal(){this.renderDeck(),document.addEventListener("mousedown",this.startDragBound),document.addEventListener("touchstart",this.startDragBound,{passive:!0}),super.showModal(),this.tooltip.swipe.show(500)}hideModal(){document.removeEventListener("mousedown",this.startDragBound),document.removeEventListener("touchstart",this.startDragBound),super.hideModal(),this.clearDeck()}renderDeck(){const e=this.el.querySelector("#deck .container");e.innerHTML="",this._.session.deck[this.slotSelected].forEach(((t,s)=>{const i=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div");o.innerHTML=`${this.slotSelected.replace("hedron","")}<span>Λ</span>`,n.classList.add("inner"),o.classList.add("type"),i.classList.add("card","back","animation","transition",this.slotSelected),i.setAttribute("id","card_"+t.number),i.setAttribute("data-index",s),i.setAttribute("data-number",t.number),i.style.zIndex=s,i.style.transform=`rotate(${t.rotation}deg) translate(${t.x}, ${t.y})`,n.appendChild(o),i.appendChild(n),e.appendChild(i)}));const t=this._.session.deck[this.slotSelected][this._.session.deck[this.slotSelected].length-1].number;this.selectedCardEl=this.el.querySelector("#card_"+t);const s=this._.session.deck[this.slotSelected][this._.session.deck[this.slotSelected].length-2].number;this.nextCardEl=this.el.querySelector("#card_"+s),this.selectedCardEl.classList.remove("transition"),this.selectedCardEl.classList.add("_selected","animation","scale-card");const i=document.createElement("button");i.classList.add("circular","_closeModal"),e.appendChild(i)}updateCards(){this._.sound.play("shuffling.ogg");const e=this.el.querySelector("#deck .container");for(let t=0;t<this._.session.deck[this.slotSelected].length;t++){const s=this._.session.deck[this.slotSelected][t],i=e.querySelector(`#card_${s.number}`);i.style.zIndex=t,i.dataset.index=t,i.dataset.number=s.number,i.style.transform=`rotate(${s.rotation}deg) translate(${s.x}, ${s.y})`}const t=this._.session.deck[this.slotSelected][this._.session.deck[this.slotSelected].length-1].number;this.selectedCardEl=this.el.querySelector("#card_"+t);const s=this._.session.deck[this.slotSelected][this._.session.deck[this.slotSelected].length-2].number;this.nextCardEl=this.el.querySelector("#card_"+s),this.selectedCardEl.classList.add("_selected","animation","scale-card")}clearDeck(){const e=this.el.querySelector("#deck"),t=this.el.querySelector("#selectedCard"),s=this.el.querySelector("#selected_card_back"),i=this.el.querySelector("#selected_card_front");e.classList.remove("collapse"),t.classList.add("hide"),i.classList.add("hide"),s.classList.remove("hide","octahedron","icosahedron","dodecahedron")}createCard(e,t){return`\n      <div class="card front ${t}" style="background-image: url(/img/${t}-${e}.webp)">\n        <div class="inner">\n          <div class="number">\n            <p>${e}</p>\n            <div class="animation rotating"></div>\n          </div>\n          <div class="name">${this._.translation.cards[t][e]}</div>\n        </div>\n      </div>\n    `}startSelection(){this.isSelecting=!0,this.addTransition(this.selectedCardEl),this.selectedCardEl.style.marginTop="-50px",this.startSelectionTimeout=setTimeout((async()=>{!this.isAnimating&&this.isSelecting&&(this.selectedCardEl.classList.add("horizontal-shaking"),this._.sound.play("holding.ogg"),await this.showProgressBar(1200),this.cardSelected())}),1e3)}stopSelection(){"holding"===this._.sound.playing.id&&this._.sound.stop(),this.selectedCardEl.classList.remove("horizontal-shaking"),clearTimeout(this.startSelectionTimeout),this.selectedCardEl.style.marginTop="0",this.cancelProgressBar()}setSlot(e,t){const s=this.el.querySelector(".slot."+e),i=this.createCard(t,e);s.classList.add("lock","subtle-levitation"),s.innerHTML=i}async cardSelected(){this.tooltip.swipe.hide({remove:!0}),this.tooltip.hold.hide({remove:!0});const e=this.el.querySelector("#deck"),t=this.el.querySelector("#selectedCard"),s=t.querySelector("#selected_card_back"),i=t.querySelector("#selected_card_front"),n=s.querySelector(".type"),o=this.selectedCardEl.dataset.number,r=this.createCard(o,this.slotSelected);i.innerHTML=r,s.classList.add(this.slotSelected),n.innerHTML=`${this.slotSelected.replace("hedron","")}<span>Λ</span>`,e.classList.add("collapse"),t.classList.remove("hide"),this._.sound.play("chosen.ogg"),await this.playAnimation("#selected_card_back","wobble",1e3),await this.playAnimation("#selected_card_back","flip-out-y"),s.classList.add("hide"),i.classList.remove("hide"),this._.sound.play("reveal.ogg"),await this.playAnimation("#selected_card_front","flip-in-y",1e3),await this._.delay(1500),await this.playAnimation("#selected_card_front","zoom-out-up",800),this.setSlot(this.slotSelected,o),this.saveSlot(this.slotSelected,o),this.hideModal()}startDrag(e){this.isAnimating||(this.startX=e.pageX??e.touches[0].pageX,document.addEventListener("mousemove",this.onMoveBound),document.addEventListener("mouseup",this.onEndBound),document.addEventListener("touchmove",this.onMoveBound,{passive:!0}),document.addEventListener("touchend",this.onEndBound,{passive:!0}),this.startSelection())}onMove(e){const t=e.pageX??e.touches[0].pageX;if(this.dragDistance=t-Math.floor(this.startX),0===this.dragDistance)return;this.selectedCardEl.classList.remove("transition"),this.isAnimating=!0;const s=this.dragDistance/12;let i=1-Math.abs(this.dragDistance)/300*.5;i=Math.max(.5,i),this.selectedCardEl.style.transform=`translateX(${this.dragDistance}px) rotate(${s}deg) scale(${i})`,this.selectedCardEl.style.cursor="grabbing";const n=Math.abs(this.dragDistance)>=this.THRESHOLD;this.selectedCardEl.style.zIndex=n?0:11}async onEnd(){this.stopSelection(),document.removeEventListener("mousemove",this.onMoveBound),document.removeEventListener("mouseup",this.onEndBound),document.removeEventListener("touchmove",this.onMoveBound),document.removeEventListener("touchend",this.onEndBound),this.addTransition(this.selectedCardEl);const e=this._.session.deck[this.slotSelected][this.selectedCardEl.dataset.index];this.selectedCardEl.style.transform=`rotate(${e.rotation}deg) translate(${e.x}, ${e.y})`;if(Math.abs(this.dragDistance)>=this.THRESHOLD){this.selectedCardEl.classList.remove("_selected","scale-card");const e=this._.session.deck[this.slotSelected].pop();this._.session.deck[this.slotSelected].unshift(e),this.updateCards(),this.tooltip.swipe.hide({remove:!0}),this.tooltip.hold.show(500)}this.selectedCardEl.style.transform="none",this.selectedCardEl.style.cursor="grab",this.isAnimating=!1,this.isSelecting=!1,this.dragDistance=0}}class RespondingScreen extends Screen{constructor(e,t){super(e,t)}async getAnswer(){try{const e=await fetch("/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:this._.session.spread.query,o:this._.session.spread.octahedron,i:this._.session.spread.icosahedron,d:this._.session.spread.dodecahedron,lang:this._.translation.language})});if(!e.ok)return console.log("Error:",`Request failed with status ${e.status}.`),!1;const t=await e.json();return t.error?(console.log("Error:",t.error),!1):(this._.session.spread.id=t.id,this._.session.spread.answer=t.answer,this._.debug&&console.log("ID:",t.id),!0)}catch(e){return console.log("Error:",e),!1}}async ready(){const e=performance.now();let t=!1,s=0;for(;!t&&s<10;)s++,this._.debug&&console.log("Try number:",s),t=await this.getAnswer(),await this._.delay(500);const i=performance.now();await this._.delay(Math.max(4500-(i-e),0)),this._.session.spread.id&&this._.session.spread.answer&&(this._.screens.list.answerScreen.prepare(),this._.sound.play("the-answer.ogg"),await this._.delay(250),this._.screens.goTo("answerScreen"))}}class AnswerScreen extends Screen{constructor(e,t){super(e,t)}tooltips(){this.tooltip.shared=new Tooltip(this.el.querySelector(".container"),{text:this._.translation.texts.tooltip_shared,position:"bottom",duration:4e3})}ready(){localStorage.removeItem("session")}prepare(){const e=this.el.querySelector("h2"),t=this.el.querySelector("h1 span"),s=this.el.querySelector(".number h3");e.innerText=this._.session.spread.query,t.innerText=this._.session.spread.answer,s.innerText=`${this._.session.spread.octahedron} ${this._.session.spread.icosahedron} ${this._.session.spread.dodecahedron}`}events(){this.addEvent("click","._share",(async function(e){const t=`https://astroz.ar/?share=${this._.session.spread.id}`;navigator.share?navigator.share({title:this._.translation.texts.sharing_look,text:this._.translation.texts.sharing_question+this._.session.spread.query+"\n\n"+this._.translation.texts.sharing_look,url:t}).then((()=>{this._.debug&&console.log("Enlace compartido.")})):(navigator.clipboard.writeText(t),this.tooltip.shared.show())})),this.addEvent("click","._retry",(async function(e){this._.newSession(),this._.screens.list.welcomeScreen.reset(),this._.screens.list.queryScreen.reset(),this._.screens.list.slotsScreen.reset(),this._.screens.goTo("welcomeScreen")}))}}window.onresize=function(){window.astrozar.screens.updateViewport()};